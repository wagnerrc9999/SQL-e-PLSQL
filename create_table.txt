/*
PURGE RECYCLEBIN;
DROP TABLE ESPECIALIDADE CASCADE CONSTRAINT PURGE;
DROP TABLE CONVENIO CASCADE CONSTRAINT PURGE;
DROP TABLE MEDICO CASCADE CONSTRAINT PURGE;
DROP TABLE PACIENTE CASCADE CONSTRAINT PURGE;
DROP TABLE ATENDIMENTO CASCADE CONSTRAINT PURGE;
*/

CREATE TABLE ESPECIALIDADE (
 COD_ESPEC NUMBER(3) CONSTRAINT PK_ESP_COD PRIMARY KEY,
 NOME VARCHAR2(30) CONSTRAINT NN_ESP_NOM NOT NULL,
 OBS VARCHAR2(100)
);

CREATE TABLE CONVENIO (
 COD_CONV VARCHAR2(6) CONSTRAINT PK_CNV_COD PRIMARY KEY,
 NOME VARCHAR2(20) CONSTRAINT NN_CNV_NOM NOT NULL,
 STATUS NUMBER(1) CONSTRAINT CK_CNV_STA CHECK(STATUS IN (0, 1, 2))
);

CREATE TABLE MEDICO (
 COD_MED NUMBER(4) CONSTRAINT PK_MED_COD PRIMARY KEY,
 NOME VARCHAR2(50) CONSTRAINT NN_MED_NOM NOT NULL,
 TITULO VARCHAR2(10),
 CRM NUMBER(6),
 UF_CRM VARCHAR2(2),
 DT_CADAS DATE DEFAULT SYSDATE,
 COD_ESPEC NUMBER(3) CONSTRAINT NN_MED_CODESP NOT NULL
 CONSTRAINT FK_MED_CODESP_ESP_COD REFERENCES ESPECIALIDADE(COD_ESPEC),
 CONSTRAINT UK_MED_CRM UNIQUE (CRM, UF_CRM)
);

CREATE TABLE PACIENTE (
 COD_PAC NUMBER(7) CONSTRAINT PK_PAC_COD PRIMARY KEY,
 NOME VARCHAR2(50) CONSTRAINT NN_PAC_NOM NOT NULL,
 DT_NASC DATE CONSTRAINT NN_PAC_DATNSC NOT NULL,
 SEXO CHAR(1) CONSTRAINT NN_PAC_SEX NOT NULL
 CONSTRAINT CK_PAC_SEX CHECK(SEXO IN ('F','M')),
 COD_CONV VARCHAR2(6) CONSTRAINT FK_PAC_COD_CNV_COD REFERENCES CONVENIO(COD_CONV),
 HISTORICO VARCHAR2(4000)
);

CREATE TABLE ATENDIMENTO (
 COD_PAC NUMBER(7),
 COD_MED NUMBER(4),
 DT_ATEND DATE,
 DT_RETORNO DATE,
 PRECO NUMBER(7,2) CONSTRAINT CK_ATD_PRE CHECK(PRECO>=0),
 OBS VARCHAR2(500),
 CONSTRAINT PK_ATD_CODPACMEDDATATD PRIMARY KEY(COD_PAC, COD_MED, DT_ATEND),
 CONSTRAINT FK_ATD_CODPAC_PAC_COD FOREIGN KEY(COD_PAC) REFERENCES PACIENTE(COD_PAC),
 CONSTRAINT FK_ATD_CODMED_MED_COD FOREIGN KEY(COD_MED) REFERENCES MEDICO(COD_MED)
);